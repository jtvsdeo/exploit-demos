# HTB medium BOX SolidState

## Enumeration Stage


As always nmap scan: I ran an `nmap -p- 10.10.10.51` scan first, then:

`nmap -sC -sV -A 10.10.10.51 -p 22,25,80,110,119,4555  `
```
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-12 18:11 EDT
Nmap scan report for 10.10.10.51
Host is up (0.020s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 77:00:84:f5:78:b9:c7:d3:54:cf:71:2e:0d:52:6d:8b (RSA)
|   256 78:b8:3a:f6:60:19:06:91:f5:53:92:1d:3f:48:ed:53 (ECDSA)
|_  256 e4:45:e9:ed:07:4d:73:69:43:5a:12:70:9d:c4:af:76 (ED25519)
25/tcp   open  smtp    JAMES smtpd 2.3.2
|_smtp-commands: solidstate Hello nmap.scanme.org (10.10.14.48 [10.10.14.48]), PIPELINING, ENHANCEDSTATUSCODES
80/tcp   open  http    Apache httpd 2.4.25 ((Debian))
|_http-title: Home - Solid State Security
|_http-server-header: Apache/2.4.25 (Debian)
110/tcp  open  pop3    JAMES pop3d 2.3.2
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
119/tcp  open  nntp    JAMES nntpd (posting ok)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
4555/tcp open  rsip?
| fingerprint-strings: 
|   GenericLines: 
|     JAMES Remote Administration Tool 2.3.2
|     Please enter your login and password
|     Login id:
|     Password:
|     Login failed for 
|_    Login id:
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port4555-TCP:V=7.92%I=7%D=5/12%Time=627D860F%P=x86_64-pc-linux-gnu%r(Ge
SF:nericLines,7C,"JAMES\x20Remote\x20Administration\x20Tool\x202\.3\.2\nPl
SF:ease\x20enter\x20your\x20login\x20and\x20password\nLogin\x20id:\nPasswo
SF:rd:\nLogin\x20failed\x20for\x20\nLogin\x20id:\n");
Service Info: Host: solidstate; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 242.84 seconds

```

### Port 25: James smtpd 2.3.2
Searchsploit shows an authenticated RCE for this version. Need to enumerate for credentials.

### Port 80: Http
About us page yields an email address to reach out to: ``webadmin@solid-state-security.com``

### Port 4555: rsip
Loggin into rsip with default creds `root:root` gives us access.

## Exploiting 

### Port 4555: rsip
Loggin into rsip with default creds `root:root` gives us access.
After logging in `listusers` commands gives us all the users names and we can use the `setpassword` command to  reset their password there.

### Port 110:
After resetting all the passwords, we can now login to POP3 port 110.
Loggin into mindy's account presents a mail with her SSH creds.

Logging into mindy's account, there are rbash restrictions. These could be escaped using the james smtpd 2.3.2 rce exploit. 
Once mindy logs in, our listener gets a shell and can exec any commands.

## Privesc

Once logged in, a python file writeable permissions is found in /opt which is ran as a cronjob by root.
This file can be changed to the following: 

```
#!/usr/bin/python
import os
os.system(cp /root/root.txt /tmp/root.txt; chmod +r /tmp/root.txt)
```


